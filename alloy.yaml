alloy:
  mounts:
    varlog: false
    dockercontainers: false
    extra: # Will be mounted as /var/log/server1/logs/server1-0
      - name: server1
        mountPath: /var/log/server1
      - name: server2
        mountPath: /var/log/server2
      - name: server3
        mountPath: /var/log/server3
      - name: server4
        mountPath: /var/log/server4
  serviceMonitor:
    enabled: true
  configReloader:
    enabled: false
  securityContext:
    privileged: true
    runAsUser: 0
  configMap:
    content: |-
      
      local.file_match "local_files" {
          path_targets = [
            {"__path__" = "/var/log/server*/logs/server*/debug.log", "job" = "neo4j", "hostname" = constants.hostname, "logtype" = "debuglog"},
            {"__path__" = "/var/log/server*/logs/server*/query.log", "job" = "neo4j", "hostname" = constants.hostname, "logtype" = "querylog"},
            {"__path__" = "/var/log/server*/logs/server*/security.log", "job" = "neo4j", "hostname" = constants.hostname, "logtype" = "securitylog"},
            {"__path__" = "/var/log/server*/logs/server*/neo4j.log", "job" = "neo4j", "hostname" = constants.hostname, "logtype" = "neo4jlog"},
          ]
          sync_period  = "5s"
      }

      loki.source.file "log_scrape" {
          targets    = local.file_match.local_files.targets
          forward_to = [loki.write.loki.receiver]
          tail_from_end = true
      }

      loki.write "loki" {
        endpoint {
          url = "http://loki-headless.monitoring.svc.cluster.local:3100/loki/api/v1/push"
        }
      }
controller:
  type: daemonset
  volumes:
    extra:
      - name: server1
        persistentVolumeClaim:
          claimName: logs-server1-0
          readOnly: true
      - name: server2
        persistentVolumeClaim:
          claimName: logs-server2-0
          readOnly: true
      - name: server3
        persistentVolumeClaim:
          claimName: logs-server3-0
          readOnly: true
      - name: server4
        persistentVolumeClaim:
          claimName: logs-server4-0
          readOnly: true